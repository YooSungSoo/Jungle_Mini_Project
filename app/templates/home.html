{% extends 'base.html' %}
{% block content %}
<div class="max-w-6xl mx-auto mt-10 px-4 min-h-[80vh]">
  <h1 class="text-3xl font-bold text-center mb-8">운동 메이트 모집 게시판</h1>

  <!-- ✅ 카테고리 필터 버튼 -->
  <div class="flex justify-start flex-wrap gap-3 mb-6">
    <a href="/" class="px-4 py-2 rounded border {% if not selected_category %}bg-blue-500 text-white{% else %}bg-white hover:bg-gray-100{% endif %}">
      전체
    </a>
    {% for category in categories %}
      <a href="/?category={{ category }}" 
         class="px-4 py-2 rounded border {% if selected_category == category %}bg-blue-500 text-white{% else %}bg-white hover:bg-gray-100{% endif %}">
        {{ category }}
      </a>
    {% endfor %}
  </div>

  {% if posts %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for post in posts %}
      <div class="bg-white p-6 rounded-lg shadow border h-full flex flex-col">
        <div class="flex justify-between items-center mb-2">
          <h2 class="text-xl font-semibold">{{ post.title }}</h2>
          <p class="text-sm text-gray-500">작성자: {{ post.author_nickname }}</p>
        </div>

        <p class="text-gray-700 mb-3 flex-grow">{{ post.content }}</p>

        <div class="text-sm text-gray-600 space-y-1 mb-4">
          <p>운동 종류: {{ post.category }}</p>
          <p>일시: {{ post.date }} {{ post.time }}</p>
          <p>모집 인원: {{ post.current_people }} / {{ post.max_people }}</p>
        </div>

        {% if user_id and post.author_id|string == user_id %}
        <div class="flex space-x-2 mt-auto">
          <a href="/post/{{ post._id }}/edit" class="text-blue-500 hover:underline">수정</a>
          <a href="/post/{{ post._id }}/delete" class="text-red-500 hover:underline"
            onclick="return confirm('정말 삭제하시겠습니까?')">삭제</a>
        </div>
        {% endif %}

        {% if user_id and post.author_id|string != user_id %}
        <form action="/post/{{ post._id }}/apply" method="POST" class="mt-2">
          <button type="submit" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 w-full">
            지원하기
          </button>
        </form>
        {% elif post.current_people >= post.max_people %}
          <p class="text-red-500 font-semibold mt-2">모집이 마감되었습니다.</p>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-center text-gray-500 mb-10">현재 모집 중인 글이 없습니다.</p>
  {% endif %}
  <div class="flex justify-center mt-10 space-x-2">
    {% for p in range(1, total_pages + 1) %}
      {% if p == current_page %}
        <span class="px-4 py-2 bg-blue-500 text-white rounded">{{ p }}</span>
      {% else %}
        <a href="/?page={{ p }}{% if selected_category %}&category={{ selected_category }}{% endif %}"
           class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">{{ p }}</a>
      {% endif %}
    {% endfor %}
  </div>

</div>
{% endblock %}
